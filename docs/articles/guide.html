<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reading, querying and writing GWAS summary data in VCF format • gwasvcf</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reading, querying and writing GWAS summary data in VCF format">
<meta property="og:description" content="gwasvcf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gwasvcf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/guide.html">Reading, querying and writing GWAS summary data in VCF format</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrcieu/gwasvcf/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reading, querying and writing GWAS summary data in VCF format</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrcieu/gwasvcf/blob/master/vignettes/guide.Rmd"><code>vignettes/guide.Rmd</code></a></small>
      <div class="hidden name"><code>guide.Rmd</code></div>

    </div>

    
    
<p>We developed a format for storing and harmonising GWAS summary data known as <a href="https://github.com/MRCIEU/gwas_vcf_spec">GWAS VCF format</a>. This format is effective for being very fast when querying chromosome and position ranges, handling multiallelic variants and indels.</p>
<p>All the data in the <a href="https://gwas.mrcieu.ac.uk/">IEU GWAS database</a> is available for download in the GWAS VCF format. This R package provides fast and convenient functions for querying and creating GWAS summary data in GWAS VCF format. The package builds on the <a href="https://bioconductor.org/packages/release/bioc/html/VariantAnnotation.html">VariantAnnotation</a> Bioconductor package, which itself is based on the widely used <a href="https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html">SummarizedExperiment</a> Bioconductor package.</p>
<div id="external-tools" class="section level2">
<h2 class="hasAnchor">
<a href="#external-tools" class="anchor"></a>External tools</h2>
<p>For some VCF querying functions it is faster to optionally use <a href="https://samtools.github.io/bcftools/bcftools.html">bcftools</a>, and when available the R package will use that strategy. To set a location for the bcftools package, use</p>
<pre><code><a href="../reference/set_bcftools.html">set_bcftools('/path/to/bcftools')</a></code></pre>
<p>Note that there is bcftools binary for Windows available, so some querying options will be slower on Windows.</p>
<p>For LD related functions the package uses <a href="https://www.cog-genomics.org/plink/1.9">plink 1.90</a>. You can specify the location of your plink installation by running</p>
<pre><code><a href="../reference/set_plink.html">set_plink('/path/to/plink')</a></code></pre>
<p>Alternatively you can automatically use use the binaries bundled here: <a href="https://github.com/explodecomputer/genetics.binaRies" class="uri">https://github.com/explodecomputer/genetics.binaRies</a></p>
<pre><code><a href="https://devtools.r-lib.org//reference/remote-reexports.html">devtools::install_github('explodecomputer/genetics.binaRies')
set_plink()
set_bcftools()</a></code></pre>
<p>To unset a path:</p>
<pre><code><a href="../reference/set_plink.html">set_plink(NULL)
set_bcftools(NULL)</a></code></pre>
<p>For this vignette we will use the bundled binaries in <code>genetics.binaRies</code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>({
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gwasvcf</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">VariantAnnotation</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
}))
<span class="fu"><a href="../reference/set_bcftools.html">set_bcftools</a></span>()
<span class="co">#&gt; Loading required namespace: genetics.binaRies</span>
<span class="co">#&gt; Path not provided, using binaries in the explodecomputer/genetics.binaRies package</span></pre></body></html></div>
</div>
<div id="reading-in-everything" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-in-everything" class="anchor"></a>Reading in everything</h2>
<p>To read an entire dataset use the <code>readVcf</code> function. As an example we’ll use the bundled data which is a small subset of the Speliotes et al 2010 BMI GWAS.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">vcffile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"data.vcf.gz"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"gwasvcf"</span>)
<span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html">readVcf</a></span>(<span class="no">vcffile</span>)
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">vcf</span>)
<span class="co">#&gt; [1] "CollapsedVCF"</span>
<span class="co">#&gt; attr(,"package")</span>
<span class="co">#&gt; [1] "VariantAnnotation"</span></pre></body></html></div>
<p>Please refer to the <code>VariantAnnotation</code> package documentation for full details about the <code>CollapsedVCF</code> object. A brief summary follows.</p>
<p>General info about the dataset can be obtained by calling it:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">vcf</span>
<span class="co">#&gt; class: CollapsedVCF </span>
<span class="co">#&gt; dim: 92 1 </span>
<span class="co">#&gt; rowRanges(vcf):</span>
<span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span>
<span class="co">#&gt; info(vcf):</span>
<span class="co">#&gt;   DataFrame with 1 column: AF</span>
<span class="co">#&gt; info(header(vcf)):</span>
<span class="co">#&gt;       Number Type  Description     </span>
<span class="co">#&gt;    AF A      Float Allele Frequency</span>
<span class="co">#&gt; geno(vcf):</span>
<span class="co">#&gt;   SimpleList of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span>
<span class="co">#&gt; geno(header(vcf)):</span>
<span class="co">#&gt;       Number Type   Description                                                </span>
<span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele    </span>
<span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                     </span>
<span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                         </span>
<span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study        </span>
<span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                </span>
<span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and...</span>
<span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                  </span>
<span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect            </span>
<span class="co">#&gt;    ID 1      String Study variant identifier</span></pre></body></html></div>
<p>There are 92 rows and 1 column which means 92 SNPs and one GWAS. See the header information:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/VCFHeader-class.html">header</a></span>(<span class="no">vcf</span>)
<span class="co">#&gt; class: VCFHeader </span>
<span class="co">#&gt; samples(1): IEU-a-2</span>
<span class="co">#&gt; meta(4): fileformat META SAMPLE contig</span>
<span class="co">#&gt; fixed(1): FILTER</span>
<span class="co">#&gt; info(1): AF</span>
<span class="co">#&gt; geno(9): ES SE ... NC ID</span></pre></body></html></div>
<p>See the names of the GWAS datasets (in this case just one, and it refers to the IEU GWAS database ID name):</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/VCFHeader-class.html">samples</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/VCFHeader-class.html">header</a></span>(<span class="no">vcf</span>))
<span class="co">#&gt; [1] "IEU-a-2"</span></pre></body></html></div>
<p>In this case you can obtain information about this study through the <code>ieugwasr</code> package e.g. <code><a href="https://rdrr.io/pkg/ieugwasr/man/gwasinfo.html">ieugwasr::gwasinfo("IEU-a-2")</a></code>.</p>
<p>There are a few components within the object:</p>
<ul>
<li>
<code>header</code> which has the meta data describing the dataset, including the association result variables</li>
<li>
<code>rowRanges</code> which is information about each variant</li>
<li>
<code>info</code> which is further metadata about each variant</li>
<li>
<code>geno</code> which is the actual association results for each GWAS</li>
</ul>
<p>the <code>rowRanges</code> object is a <code>GenomicRanges</code> class, which is useful for performing fast operations on chromosome position information.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu">rowRanges</span>(<span class="no">vcf</span>)
<span class="co">#&gt; GRanges object with 92 ranges and 5 metadata columns:</span>
<span class="co">#&gt;              seqnames    ranges strand | paramRangeID            REF</span>
<span class="co">#&gt;                 &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;factor&gt; &lt;DNAStringSet&gt;</span>
<span class="co">#&gt;   rs12565286        1    721290      * |         &lt;NA&gt;              G</span>
<span class="co">#&gt;   rs11804171        1    723819      * |         &lt;NA&gt;              T</span>
<span class="co">#&gt;    rs2977670        1    723891      * |         &lt;NA&gt;              G</span>
<span class="co">#&gt;    rs3094315        1    752566      * |         &lt;NA&gt;              G</span>
<span class="co">#&gt;    rs2073813        1    753541      * |         &lt;NA&gt;              G</span>
<span class="co">#&gt;          ...      ...       ...    ... .          ...            ...</span>
<span class="co">#&gt;     rs715643        1   1172907      * |         &lt;NA&gt;              C</span>
<span class="co">#&gt;    rs6675798        1   1176597      * |         &lt;NA&gt;              T</span>
<span class="co">#&gt;    rs6603783        1   1181751      * |         &lt;NA&gt;              T</span>
<span class="co">#&gt;    rs6603785        1   1186502      * |         &lt;NA&gt;              A</span>
<span class="co">#&gt;    rs6603787        1   1188225      * |         &lt;NA&gt;              G</span>
<span class="co">#&gt;                             ALT      QUAL      FILTER</span>
<span class="co">#&gt;              &lt;DNAStringSetList&gt; &lt;numeric&gt; &lt;character&gt;</span>
<span class="co">#&gt;   rs12565286                  C      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;   rs11804171                  A      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs2977670                  C      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs3094315                  A      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs2073813                  A      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;          ...                ...       ...         ...</span>
<span class="co">#&gt;     rs715643                  T      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs6675798                  C      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs6603783                  C      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs6603785                  T      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;    rs6603787                  T      &lt;NA&gt;        PASS</span>
<span class="co">#&gt;   -------</span>
<span class="co">#&gt;   seqinfo: 84 sequences from GRCh37 genome</span></pre></body></html></div>
</div>
<div id="converting-to-simple-dataframes" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-to-simple-dataframes" class="anchor"></a>Converting to simple dataframes</h2>
<p>The VCF object is somewhat complex and you can read more about it in the ’VariantAnnotation package documentation](<a href="https://bioconductor.org/packages/release/bioc/html/VariantAnnotation.html" class="uri">https://bioconductor.org/packages/release/bioc/html/VariantAnnotation.html</a>). You can create various other formats that might be easier to use from it. For example, create a <code>GRanges</code> object which is great for fast chromosome-position operations</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>(<span class="no">vcf</span>)
<span class="co">#&gt; GRanges object with 92 ranges and 15 metadata columns:</span>
<span class="co">#&gt;              seqnames    ranges strand | paramRangeID         REF         ALT</span>
<span class="co">#&gt;                 &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;factor&gt; &lt;character&gt; &lt;character&gt;</span>
<span class="co">#&gt;   rs12565286        1    721290      * |         &lt;NA&gt;           G           C</span>
<span class="co">#&gt;   rs11804171        1    723819      * |         &lt;NA&gt;           T           A</span>
<span class="co">#&gt;    rs2977670        1    723891      * |         &lt;NA&gt;           G           C</span>
<span class="co">#&gt;    rs3094315        1    752566      * |         &lt;NA&gt;           G           A</span>
<span class="co">#&gt;    rs2073813        1    753541      * |         &lt;NA&gt;           G           A</span>
<span class="co">#&gt;          ...      ...       ...    ... .          ...         ...         ...</span>
<span class="co">#&gt;     rs715643        1   1172907      * |         &lt;NA&gt;           C           T</span>
<span class="co">#&gt;    rs6675798        1   1176597      * |         &lt;NA&gt;           T           C</span>
<span class="co">#&gt;    rs6603783        1   1181751      * |         &lt;NA&gt;           T           C</span>
<span class="co">#&gt;    rs6603785        1   1186502      * |         &lt;NA&gt;           A           T</span>
<span class="co">#&gt;    rs6603787        1   1188225      * |         &lt;NA&gt;           G           T</span>
<span class="co">#&gt;                   QUAL      FILTER        ES        SE        LP        AF</span>
<span class="co">#&gt;              &lt;numeric&gt; &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="co">#&gt;   rs12565286      &lt;NA&gt;        PASS   -0.0067    0.0145  0.193006    0.9322</span>
<span class="co">#&gt;   rs11804171      &lt;NA&gt;        PASS   -0.0146    0.0175  0.393511   0.96296</span>
<span class="co">#&gt;    rs2977670      &lt;NA&gt;        PASS    0.0044    0.0184 0.0909791   0.07143</span>
<span class="co">#&gt;    rs3094315      &lt;NA&gt;        PASS     0.006    0.0065   0.44855    0.1552</span>
<span class="co">#&gt;    rs2073813      &lt;NA&gt;        PASS    0.0035    0.0102  0.135786      &lt;NA&gt;</span>
<span class="co">#&gt;          ...       ...         ...       ...       ...       ...       ...</span>
<span class="co">#&gt;     rs715643      &lt;NA&gt;        PASS    0.0019    0.0118 0.0594337   0.90833</span>
<span class="co">#&gt;    rs6675798      &lt;NA&gt;        PASS   -0.0013    0.0067  0.072527    0.8917</span>
<span class="co">#&gt;    rs6603783      &lt;NA&gt;        PASS    -2e-04    0.0069 0.0101499       0.9</span>
<span class="co">#&gt;    rs6603785      &lt;NA&gt;        PASS    0.0075    0.0104  0.327164   0.91667</span>
<span class="co">#&gt;    rs6603787      &lt;NA&gt;        PASS    0.0025    0.0089  0.108574      &lt;NA&gt;</span>
<span class="co">#&gt;                     SS        EZ        SI        NC          ID          id</span>
<span class="co">#&gt;              &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt; &lt;character&gt;</span>
<span class="co">#&gt;   rs12565286    109823      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;  rs12565286     IEU-a-2</span>
<span class="co">#&gt;   rs11804171     84828      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;  rs11804171     IEU-a-2</span>
<span class="co">#&gt;    rs2977670   68458.9      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs2977670     IEU-a-2</span>
<span class="co">#&gt;    rs3094315    131544      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs3094315     IEU-a-2</span>
<span class="co">#&gt;    rs2073813   64351.3      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs2073813     IEU-a-2</span>
<span class="co">#&gt;          ...       ...       ...       ...       ...         ...         ...</span>
<span class="co">#&gt;     rs715643    121822      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;    rs715643     IEU-a-2</span>
<span class="co">#&gt;    rs6675798    223475      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs6675798     IEU-a-2</span>
<span class="co">#&gt;    rs6603783    220022      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs6603783     IEU-a-2</span>
<span class="co">#&gt;    rs6603785    165964      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs6603785     IEU-a-2</span>
<span class="co">#&gt;    rs6603787    199099      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs6603787     IEU-a-2</span>
<span class="co">#&gt;   -------</span>
<span class="co">#&gt;   seqinfo: 84 sequences from GRCh37 genome</span></pre></body></html></div>
<p>Create a data frame:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>(<span class="no">vcf</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>()
<span class="co">#&gt; # A tibble: 92 x 20</span>
<span class="co">#&gt;    seqnames  start    end width strand paramRangeID REF   ALT    QUAL FILTER</span>
<span class="co">#&gt;    &lt;fct&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;        &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#&gt;  1 1        721290 721290     1 *      &lt;NA&gt;         G     C        NA PASS  </span>
<span class="co">#&gt;  2 1        723819 723819     1 *      &lt;NA&gt;         T     A        NA PASS  </span>
<span class="co">#&gt;  3 1        723891 723891     1 *      &lt;NA&gt;         G     C        NA PASS  </span>
<span class="co">#&gt;  4 1        752566 752566     1 *      &lt;NA&gt;         G     A        NA PASS  </span>
<span class="co">#&gt;  5 1        753541 753541     1 *      &lt;NA&gt;         G     A        NA PASS  </span>
<span class="co">#&gt;  6 1        754192 754192     1 *      &lt;NA&gt;         A     G        NA PASS  </span>
<span class="co">#&gt;  7 1        768448 768448     1 *      &lt;NA&gt;         G     A        NA PASS  </span>
<span class="co">#&gt;  8 1        775659 775659     1 *      &lt;NA&gt;         A     G        NA PASS  </span>
<span class="co">#&gt;  9 1        777122 777122     1 *      &lt;NA&gt;         A     T        NA PASS  </span>
<span class="co">#&gt; 10 1        779322 779322     1 *      &lt;NA&gt;         A     G        NA PASS  </span>
<span class="co">#&gt; # … with 82 more rows, and 10 more variables: ES &lt;dbl&gt;, SE &lt;dbl&gt;, LP &lt;dbl&gt;,</span>
<span class="co">#&gt; #   AF &lt;dbl&gt;, SS &lt;dbl&gt;, EZ &lt;dbl&gt;, SI &lt;dbl&gt;, NC &lt;dbl&gt;, ID &lt;chr&gt;, id &lt;chr&gt;</span></pre></body></html></div>
<p>The direct conversion to formats for tools such as TwoSampleMR, coloc, and many others can also be made using the <a href="https://github.com/mrcieu/gwasglue">https://github.com/mrcieu/gwasglue</a> R package.</p>
</div>
<div id="reading-in-with-filters" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-in-with-filters" class="anchor"></a>Reading in with filters</h2>
<p>The <code>query_gwas</code> function takes either a filename to a vcf file, or vcf object as the main argument. You can then query on <code>rsid</code>, <code>pval</code> or <code>chrompos</code>. For example</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">vcfsubset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">chrompos</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1:1097291-1099437"</span>))</pre></body></html></div>
<p>and</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html">readVcf</a></span>(<span class="no">vcffile</span>)
<span class="no">vcfsubset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcf</span>, <span class="kw">chrompos</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1:1097291-1099437"</span>))</pre></body></html></div>
<p>are each identical, but the former saves time and memory because it is querying the file using an index and only reading in what is required.</p>
<p>Examples of other filters are here:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span>))
<span class="no">vcf</span>
<span class="co">#&gt; class: CollapsedVCF </span>
<span class="co">#&gt; dim: 3 1 </span>
<span class="co">#&gt; rowRanges(vcf):</span>
<span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span>
<span class="co">#&gt; info(vcf):</span>
<span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span>
<span class="co">#&gt; info(header(vcf)):</span>
<span class="co">#&gt;       Number Type    Description                                </span>
<span class="co">#&gt;    AF A      Float   Allele Frequency                           </span>
<span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span>
<span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span>
<span class="co">#&gt; geno(vcf):</span>
<span class="co">#&gt;   SimpleList of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span>
<span class="co">#&gt; geno(header(vcf)):</span>
<span class="co">#&gt;       Number Type   Description                                                </span>
<span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele    </span>
<span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                     </span>
<span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                         </span>
<span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study        </span>
<span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                </span>
<span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and...</span>
<span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                  </span>
<span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect            </span>
<span class="co">#&gt;    ID 1      String Study variant identifier</span></pre></body></html></div>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">pval</span><span class="kw">=</span><span class="fl">0.5</span>)
<span class="no">vcf</span>
<span class="co">#&gt; class: CollapsedVCF </span>
<span class="co">#&gt; dim: 45 1 </span>
<span class="co">#&gt; rowRanges(vcf):</span>
<span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span>
<span class="co">#&gt; info(vcf):</span>
<span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span>
<span class="co">#&gt; info(header(vcf)):</span>
<span class="co">#&gt;       Number Type    Description                                </span>
<span class="co">#&gt;    AF A      Float   Allele Frequency                           </span>
<span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span>
<span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span>
<span class="co">#&gt; geno(vcf):</span>
<span class="co">#&gt;   SimpleList of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span>
<span class="co">#&gt; geno(header(vcf)):</span>
<span class="co">#&gt;       Number Type   Description                                                </span>
<span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele    </span>
<span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                     </span>
<span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                         </span>
<span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study        </span>
<span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                </span>
<span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and...</span>
<span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                  </span>
<span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect            </span>
<span class="co">#&gt;    ID 1      String Study variant identifier</span></pre></body></html></div>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">chrompos</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1:1097291-1099437"</span>))
<span class="no">vcf</span>
<span class="co">#&gt; class: CollapsedVCF </span>
<span class="co">#&gt; dim: 2 1 </span>
<span class="co">#&gt; rowRanges(vcf):</span>
<span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span>
<span class="co">#&gt; info(vcf):</span>
<span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span>
<span class="co">#&gt; info(header(vcf)):</span>
<span class="co">#&gt;       Number Type    Description                                </span>
<span class="co">#&gt;    AF A      Float   Allele Frequency                           </span>
<span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span>
<span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span>
<span class="co">#&gt; geno(vcf):</span>
<span class="co">#&gt;   SimpleList of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span>
<span class="co">#&gt; geno(header(vcf)):</span>
<span class="co">#&gt;       Number Type   Description                                                </span>
<span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele    </span>
<span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                     </span>
<span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                         </span>
<span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study        </span>
<span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                </span>
<span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and...</span>
<span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                  </span>
<span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect            </span>
<span class="co">#&gt;    ID 1      String Study variant identifier</span></pre></body></html></div>
<p>It’s possible to chain filters together e.g.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="kw">pval</span><span class="kw">=</span><span class="fl">0.5</span>)
<span class="no">vcf</span>
<span class="co">#&gt; class: CollapsedVCF </span>
<span class="co">#&gt; dim: 1 1 </span>
<span class="co">#&gt; rowRanges(vcf):</span>
<span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span>
<span class="co">#&gt; info(vcf):</span>
<span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span>
<span class="co">#&gt; info(header(vcf)):</span>
<span class="co">#&gt;       Number Type    Description                                </span>
<span class="co">#&gt;    AF A      Float   Allele Frequency                           </span>
<span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span>
<span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span>
<span class="co">#&gt; geno(vcf):</span>
<span class="co">#&gt;   SimpleList of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span>
<span class="co">#&gt; geno(header(vcf)):</span>
<span class="co">#&gt;       Number Type   Description                                                </span>
<span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele    </span>
<span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                     </span>
<span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                         </span>
<span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study        </span>
<span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                </span>
<span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and...</span>
<span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                  </span>
<span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect            </span>
<span class="co">#&gt;    ID 1      String Study variant identifier</span></pre></body></html></div>
<p>It’s possible to have multiple GWAS studies per vcf. You can specify specific GWAS studies to read in using e.g.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span>), <span class="kw">id</span><span class="kw">=</span><span class="st">"IEU-a-2"</span>)</pre></body></html></div>
<p>Note that querying by chrompos is the fastest way to deal with VCFs, use this over rsid where possible when speed is an issue.</p>
</div>
<div id="indexing-rsid-values" class="section level2">
<h2 class="hasAnchor">
<a href="#indexing-rsid-values" class="anchor"></a>Indexing rsid values</h2>
<p>Querying by rsid is slow. If a large number of queries by rsid are to be performed then it could be worth generating an index which would speed up the querying. This approach uses <a href="https://www.sqlite.org/index.html">SQLite</a> to create a local database, linking rsid to chromosome and position. It strips out the ‘rs’ from the rs identifiers to make fast searchers by integer. The concept is based on that developed here: <a href="https://github.com/bioforensics/rsidx">bioforensics/rsidx</a>.</p>
<p>To create the index:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/create_rsidx_index_from_vcf.html">create_rsidx_index_from_vcf</a></span>(<span class="no">vcffile</span>, <span class="st">"index.rsidx"</span>)
<span class="co">#&gt; Extracting position info</span>
<span class="co">#&gt; Generating index</span></pre></body></html></div>
<p>To query using the index:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span>), <span class="kw">rsidx</span><span class="kw">=</span><span class="st">"index.rsidx"</span>)</pre></body></html></div>
</div>
<div id="a-note-about-chrompos" class="section level2">
<h2 class="hasAnchor">
<a href="#a-note-about-chrompos" class="anchor"></a>A note about chrompos</h2>
<p>The fastest way to query VCFs is by specifying chromosome and position. Can specify specific positions, or ranges. e.g.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">cp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1:10000"</span>, <span class="st">"2:10000-20000"</span>)</pre></body></html></div>
<p>or as a data frame</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">cp</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">chrom</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>), <span class="kw">start</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10000</span>,<span class="fl">10000</span>), <span class="kw">end</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10000</span>, <span class="fl">20000</span>))</pre></body></html></div>
<p>You can check what will be parsed out with:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="../reference/parse_chrompos.html">parse_chrompos</a></span>(<span class="no">cp</span>)
<span class="co">#&gt; GRanges object with 2 ranges and 0 metadata columns:</span>
<span class="co">#&gt;       seqnames      ranges strand</span>
<span class="co">#&gt;          &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt;</span>
<span class="co">#&gt;   [1]        1       10000      *</span>
<span class="co">#&gt;   [2]        2 10000-20000      *</span>
<span class="co">#&gt;   -------</span>
<span class="co">#&gt;   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span></pre></body></html></div>
<p>Querying by p-value or rsid is also possible but is slower as only chrompos is indexed. On Mac and Linux, rsid and p-value queries are performed by calls to bcftools. On Windows it uses VariantAnnotation directly, because bcftools binaries are not available. This is unfortunately somewhat slower. If many operations are being performed it might be faster to read in the whole dataset and perform queries that way.</p>
</div>
<div id="ld-proxies" class="section level2">
<h2 class="hasAnchor">
<a href="#ld-proxies" class="anchor"></a>LD proxies</h2>
<p>If a set of rsids are requested from a vcf but some are absent, a reference panel can be used to search for LD proxies, extract them, and align the effects and alleles against the original variants that were requested.</p>
<p>There are two ways to perform the LD proxy search:</p>
<ul>
<li>using a set of genotyped samples as an LD reference panel (e.g. 1000 genomes data) - this is slow but relatively convenient</li>
<li>compiling an LD tag list from an LD reference panel - once generated this is very fast</li>
</ul>
<div id="using-an-ld-reference-panel" class="section level3">
<h3 class="hasAnchor">
<a href="#using-an-ld-reference-panel" class="anchor"></a>Using an LD reference panel</h3>
<p>An LD reference panel can be obtained from here: <a href="http://fileserve.mrcieu.ac.uk/ld/data_maf0.01_rs_ref.tgz">http://fileserve.mrcieu.ac.uk/ld/data_maf0.01_rs_ref.tgz</a>. This dataset comprises Europeans from the 1000 genomes project, in plink format, and including only SNPs with MAF &gt; 0.01, and with the reference alleles aligned to the human genome reference sequence. For this vignette we can use a small subset of that dataset:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">ldfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"eur.bed"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"gwasvcf"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">".bed"</span>, <span class="st">""</span>, <span class="no">.</span>)</pre></body></html></div>
<p>We also need to provide a path to the plink binary used to generate LD calculations. This can be done through the <code>genetics.binaRies</code> package as with bcftools</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span>()
<span class="co">#&gt; Path not provided, using binaries in the explodecomputer/genetics.binaRies package</span></pre></body></html></div>
<p>The rs4442317 variant is not present in the vcf file, i.e. if we query that variant:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="st">"rs4442317"</span>) <span class="kw">%&gt;%</span> <span class="no">nrow</span>
<span class="co">#&gt; [1] 0</span></pre></body></html></div>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="st">"rs4442317"</span>, <span class="kw">proxies</span><span class="kw">=</span><span class="st">"yes"</span>, <span class="kw">bfile</span><span class="kw">=</span><span class="no">ldfile</span>, <span class="kw">tag_r2</span><span class="kw">=</span><span class="fl">0.05</span>)
<span class="co">#&gt; Initial search...</span>
<span class="co">#&gt; Extracted 0 out of 1 rsids</span>
<span class="co">#&gt; Searching for proxies for 1 rsids</span>
<span class="co">#&gt; Determining searchspace...</span>
<span class="co">#&gt; Proxy lookup...</span>
<span class="co">#&gt; Finding proxies...</span>
<span class="co">#&gt; Taking input= as a system command ('gunzip -c /var/folders/8t/4mzsfqzd5773rsc11w4q5fhw0000gp/T//RtmpFJyhZF/file12fe9280631b0.targets.ld.gz') and a variable has been used in the expression passed to `input=`. Please use fread(cmd=...). There is a security concern if you are creating an app, and the app could have a malicious user, and the app is not running in a secure environment; e.g. the app is running as root. Please read item 5 in the NEWS file for v1.11.6 for more information and for the option to suppress this message.</span>
<span class="co">#&gt; Found 10 proxies</span>
<span class="co">#&gt; Extrating proxies...</span>
<span class="co">#&gt; Identified proxies for 1 of 1 rsids</span>
<span class="co">#&gt; Aligning...</span>
<span class="no">vcf</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>()
<span class="co">#&gt; GRanges object with 1 range and 15 metadata columns:</span>
<span class="co">#&gt;             seqnames    ranges strand |         REF         ALT      QUAL</span>
<span class="co">#&gt;                &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt; &lt;numeric&gt;</span>
<span class="co">#&gt;   rs4442317        1   1106784      * |           T           C      &lt;NA&gt;</span>
<span class="co">#&gt;                  FILTER        ES        SE        LP        AF        SS</span>
<span class="co">#&gt;             &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="co">#&gt;   rs4442317        PASS    0.0059    0.0071  0.391474    0.8559    138001</span>
<span class="co">#&gt;                    EZ        SI        NC          ID          PR          id</span>
<span class="co">#&gt;             &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;</span>
<span class="co">#&gt;   rs4442317      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;   rs4970420   rs4970420     IEU-a-2</span>
<span class="co">#&gt;   -------</span>
<span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></pre></body></html></div>
<p>Here we see that the proxy variant is rs4970420.</p>
<p>You may also extract only the best available proxies even if the requested rsids are present, by using <code>proxies="only"</code>. An example of this shows that the effect size estimates for the proxy variants are aligned to the effect alleles of the target variants:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># Read vcf</span>
<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html">readVcf</a></span>(<span class="no">vcffile</span>)

<span class="co"># Obtain the best LD proxy for each of the rsids</span>
<span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">a</span>), <span class="kw">proxies</span><span class="kw">=</span><span class="st">"only"</span>, <span class="kw">bfile</span><span class="kw">=</span><span class="no">ldfile</span>, <span class="kw">tag_r2</span><span class="kw">=</span><span class="fl">0.6</span>)
<span class="co">#&gt; Determining searchspace...</span>
<span class="co">#&gt; Proxy lookup...</span>
<span class="co">#&gt; Finding proxies...</span>
<span class="co">#&gt; Taking input= as a system command ('gunzip -c /var/folders/8t/4mzsfqzd5773rsc11w4q5fhw0000gp/T//RtmpFJyhZF/file12fe918ace186.targets.ld.gz') and a variable has been used in the expression passed to `input=`. Please use fread(cmd=...). There is a security concern if you are creating an app, and the app could have a malicious user, and the app is not running in a secure environment; e.g. the app is running as root. Please read item 5 in the NEWS file for v1.11.6 for more information and for the option to suppress this message.</span>
<span class="co">#&gt; Found 270 proxies</span>
<span class="co">#&gt; Extrating proxies...</span>
<span class="co">#&gt; Identified proxies for 52 of 1 rsids</span>
<span class="co">#&gt; Aligning...</span>

<span class="co"># Match the target data to the proxy data</span>
<span class="no">index</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">b</span>), <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">a</span>))

<span class="co"># Plot the target data effects against the proxy data effects</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>(<span class="no">b</span>)$<span class="no">ES</span>, <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>(<span class="no">a</span>)$<span class="no">ES</span>[<span class="no">index</span>])</pre></body></html></div>
<p><img src="guide_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
<div id="compiling-a-list-of-tagging-variants" class="section level3">
<h3 class="hasAnchor">
<a href="#compiling-a-list-of-tagging-variants" class="anchor"></a>Compiling a list of tagging variants</h3>
<p>Using the LD reference panel described above, it is possible to create a sqlite tag reference panel using the following commands. First get an example LD reference panel:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">ldfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"eur.bed"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"gwasvcf"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">".bed"</span>, <span class="st">""</span>, <span class="no">.</span>)</pre></body></html></div>
<p>We also need to provide a path to the plink binary used to generate LD calculations. This can be done through the <code>genetics.binaRies</code> package as with bcftools</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span>()
<span class="co">#&gt; Path not provided, using binaries in the explodecomputer/genetics.binaRies package</span></pre></body></html></div>
<p>Now generate the tagging database</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">dbfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()
<span class="fu"><a href="../reference/create_ldref_sqlite.html">create_ldref_sqlite</a></span>(<span class="no">ldfile</span>, <span class="no">dbfile</span>, <span class="kw">tag_r2</span> <span class="kw">=</span> <span class="fl">0.05</span>)
<span class="co">#&gt; identifying indels to remove</span>
<span class="co">#&gt; calculating ld tags</span>
<span class="co">#&gt; formatting</span>
<span class="co">#&gt; creating sqlite db</span></pre></body></html></div>
<p>Perform the query</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span>(<span class="no">vcffile</span>, <span class="kw">rsid</span><span class="kw">=</span><span class="st">"rs4442317"</span>, <span class="kw">proxies</span><span class="kw">=</span><span class="st">"yes"</span>, <span class="kw">dbfile</span><span class="kw">=</span><span class="no">dbfile</span>, <span class="kw">tag_r2</span><span class="kw">=</span><span class="fl">0.05</span>)
<span class="co">#&gt; Initial search...</span>
<span class="co">#&gt; Extracted 0 out of 1 rsids</span>
<span class="co">#&gt; Searching for proxies for 1 rsids</span>
<span class="co">#&gt; Proxy lookup...</span>
<span class="co">#&gt; Found 168 proxies</span>
<span class="co">#&gt; Extrating proxies...</span>
<span class="co">#&gt; Identified proxies for 1 of 1 rsids</span>
<span class="co">#&gt; Aligning...</span>
<span class="no">vcf</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>()
<span class="co">#&gt; GRanges object with 1 range and 15 metadata columns:</span>
<span class="co">#&gt;             seqnames    ranges strand |         REF         ALT      QUAL</span>
<span class="co">#&gt;                &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt; &lt;numeric&gt;</span>
<span class="co">#&gt;   rs4442317        1   1106784      * |           T           C      &lt;NA&gt;</span>
<span class="co">#&gt;                  FILTER        ES        SE        LP        AF        SS</span>
<span class="co">#&gt;             &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="co">#&gt;   rs4442317        PASS    -4e-04    0.0066 0.0214999       0.9    233073</span>
<span class="co">#&gt;                    EZ        SI        NC          ID          PR          id</span>
<span class="co">#&gt;             &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;</span>
<span class="co">#&gt;   rs4442317      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;  rs10907175  rs10907175     IEU-a-2</span>
<span class="co">#&gt;   -------</span>
<span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></pre></body></html></div>
</div>
</div>
<div id="creating-the-vcf-object-from-a-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-vcf-object-from-a-data-frame" class="anchor"></a>Creating the VCF object from a data frame</h2>
<p>If you have GWAS summary data in a text file or data frame, this can be converted to a VCF object.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">vcf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html">readVcf</a></span>(<span class="no">vcffile</span>)
<span class="no">vv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span>(<span class="no">vcf</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>()
<span class="no">out</span> <span class="kw">&lt;-</span> <span class="no">vv</span> <span class="kw">%$%</span> <span class="fu"><a href="../reference/create_vcf.html">create_vcf</a></span>(<span class="kw">chrom</span><span class="kw">=</span><span class="no">seqnames</span>, <span class="kw">pos</span><span class="kw">=</span><span class="no">start</span>, <span class="kw">nea</span><span class="kw">=</span><span class="no">REF</span>, <span class="kw">ea</span><span class="kw">=</span><span class="no">ALT</span>, <span class="kw">snp</span><span class="kw">=</span><span class="no">ID</span>, <span class="kw">ea_af</span><span class="kw">=</span><span class="no">AF</span>, <span class="kw">effect</span><span class="kw">=</span><span class="no">ES</span>, <span class="kw">se</span><span class="kw">=</span><span class="no">SE</span>, <span class="kw">pval</span><span class="kw">=</span><span class="fl">10</span>^-<span class="no">LP</span>, <span class="kw">n</span><span class="kw">=</span><span class="no">SS</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"a"</span>)
<span class="no">out</span>
<span class="co">#&gt; class: CollapsedVCF </span>
<span class="co">#&gt; dim: 92 1 </span>
<span class="co">#&gt; rowRanges(vcf):</span>
<span class="co">#&gt;   GRanges with 4 metadata columns: REF, ALT, QUAL, FILTER</span>
<span class="co">#&gt; info(vcf):</span>
<span class="co">#&gt;   DataFrame with 0 columns: </span>
<span class="co">#&gt; geno(vcf):</span>
<span class="co">#&gt;   SimpleList of length 5: AF, ES, SE, LP, SS</span>
<span class="co">#&gt; geno(header(vcf)):</span>
<span class="co">#&gt;       Number Type  Description                                            </span>
<span class="co">#&gt;    AF A      Float Alternate allele frequency in the association study    </span>
<span class="co">#&gt;    ES A      Float Effect size estimate relative to the alternative allele</span>
<span class="co">#&gt;    SE A      Float Standard error of effect size estimate                 </span>
<span class="co">#&gt;    LP A      Float -log10 p-value for effect estimate                     </span>
<span class="co">#&gt;    SS A      Float Sample size used to estimate genetic effect</span></pre></body></html></div>
<p>It’s possible to write the vcf file:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/writeVcf-methods.html">writeVcf</a></span>(<span class="no">out</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"temp.vcf"</span>)</pre></body></html></div>
<p>You may want to first harmonise the data so that all the non-effect alleles are aligned to the human genome reference. See the <a href="https://github.com/MRCIEU/gwasglue">gwasglue</a> package on some functions to do this.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gibran Hemani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
